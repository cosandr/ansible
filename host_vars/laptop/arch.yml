---

host_pacman_packages:
  - acpi_call-dkms
  - fwupd
  - intel-gpu-tools
  - intel-media-driver
  - intel-ucode
  - libva-intel-driver
  - powertop
  - sof-firmware
  - upower

pacman_packages: "{{ base_pacman_packages + host_pacman_packages }}"
aur_packages: "{{ base_aur_packages + host_aur_packages }}"
host_aur_packages:
  - slack-desktop
  - teams
  - webex-bin
  - zoom

enabled_services:
  - systemd-timesyncd.service
  - firewalld.service
  - bluetooth.service
  - sshd.service

masked_services:
  - systemd-rfkill.service
  - systemd-rfkill.socket

modprobe_config:
  "nobeep.conf": "blacklist pcspkr"


# Update key
# systemd-cryptenroll /dev/nvme0n1p2 --wipe-slot=tpm2
# systemd-cryptenroll --tpm2-device=auto --tpm2-pcrs=0+1+7 /dev/nvme0n1p2

esp_src: "UUID=A14E-3411"
extra_kernel_params: "intel_iommu=on nmi_watchdog=0 console=tty7 systemd.unified_cgroup_hierarchy=0"
kernel_params: "root=/dev/mapper/root rw rootflags=subvol=@ resume=/dev/mapper/root resume_offset=941473 {{ extra_kernel_params }}"

systemd_boot_entries:
  "arch-zen": |
    title Arch Linux (Zen)
    linux /vmlinuz-linux-zen
    initrd /intel-ucode.img
    initrd /initramfs-linux-zen.img
    options {{ kernel_params }}

crypttab: ""

crypttab_initramfs: |
  root    UUID=7dc15fde-8ccd-4752-a24b-194b53b37f28   -   luks,discard,tpm2-device=auto


fstab: |
  /dev/mapper/root    	/.swap    	btrfs     	rw,relatime,compress-force=zstd:3,ssd,space_cache=v2,subvol=/@swap 0 0
  /.swap/swapfile		    none		    swap		    defaults	0 0

# go-check-updates
# git clone https://github.com/cosandr/go-check-updates
# ./setup.sh build pacman
# sudo pacman -U build/go-check-updates-git-v1.0.rc2.r6.g9af655b-1-any.pkg.tar.zst
# sudo systemctl enable --now go-check-updates.socket

sbctl_sign_files:
  - "/boot/vmlinuz-linux"
  - "/boot/vmlinuz-linux-zen"
  - "/boot/EFI/BOOT/BOOTX64.EFI"
  - "/boot/EFI/arch/fwupdx64.efi"
  - "/boot/EFI/systemd/systemd-bootx64.efi"

# ansible_form_factor: Notebook

firewalld_interfaces:
  - zone: public
    interface: wlan0

firewalld_remove_services:
  - zone: public
    service: ssh

firewalld_add_sources:
  - zone: home
    source: "10.0.0.0/24"

sbctl_bundles:
  - kernel: linux
    label: "Arch Linux"
  - kernel: linux-lts
    label: "Arch Linux LTS"

mkinitcpio_no_fallback: "{{ sbctl_bundles | map(attribute='kernel') }}"
