---

__sd_btrfs_scrub:
  name: btrfs-scrub
  service:
    content: |
      [Unit]
      Description=Scrub all BTRFS disks

      [Service]
      Type=oneshot
      ExecStart=btrfs scrub start /
      ExecStart=bash -c 'for d in /dev/mapper/tank_disk*; do btrfs scrub start -B $d; done'

      [Install]
      WantedBy=multi-user.target

  # Every first day of the month at 03:00
  timer:
    enabled: true
    state: started
    content: |
      [Unit]
      Description=Scrub BTRFS disks every month

      [Timer]
      Persistent=yes
      OnCalendar=*-*-01 03:00:00

      [Install]
      WantedBy=timers.target
