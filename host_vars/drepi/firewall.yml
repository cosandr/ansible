---

__smtp_sources:
  - "{{ wg_net.mt.cidr }}"
  - "{{ home_net | dict2items | json_query('[].value.cidr') }}"
  - "{{ home_net | dict2items | json_query('[].value.cidr6') }}"

firewall_rules:
  - port: 22
    source: "{{ home_net.general.cidr }}"

  - port: 25
    sources: "{{ __smtp_sources | flatten }}"

  - port: 465
    sources: "{{ __smtp_sources | flatten }}"

  - port: 587
    sources: "{{ __smtp_sources | flatten }}"

  - port: 8081
    source: "{{ home_net.general.cidr }}"

  - port: 2049
    protocol: tcp
    source: "{{ hostvars['theia'].local_ips.general }}"

  - port: 2049
    protocol: udp
    source: "{{ hostvars['theia'].local_ips.general }}"

  - port: "{{ node_exporter_port }}"
    source: "{{ hostvars['prom01'].ansible_host }}"

  - port: "{{ (serial_proxies | selectattr('name', 'eq', 'zigbee') | first).port }}"
    zone: public
    source: "10.0.50.48"

  # RouterOS neighbour discovery
  - port: 5678
    source: "fe80::/64"
    protocol: "udp"
