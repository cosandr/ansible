---

- name: "Set timezone"
  become: true
  file:
    src: "/usr/share/zoneinfo/{{ sys_timezone }}"
    dest: "/etc/localtime"
    owner: root
    group: root
    state: link
  tags: ["time"]

- name: "Sync hwclock"
  become: true
  command: "hwclock --systohc"
  args:
    creates: "/etc/adjtime"
  when: hwclock_sync | bool
  tags: ["time"]

- name: Configure pacman
  become: true
  lineinfile:
    path: "/etc/pacman.conf"
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  with_items: "{{ pacman_config }}"
  tags: ["pacman"]

- name: Configure makepkg
  become: true
  replace:
    path: "/etc/makepkg.conf"
    regexp: "{{ item.regexp }}"
    replace: "{{ item.replace }}"
  with_items: "{{ makepkg_config }}"
  tags: ["makepkg"]

- name: Enable and start systemd-timesyncd
  systemd:
    name: systemd-timesyncd.service
    state: started
    enabled: true
  tags: ["timesyncd"]
