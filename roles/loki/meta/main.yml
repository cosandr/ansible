---

dependencies:
  - role: firewall_config
    vars:
      firewalld_services: []
      firewalld_zones:
        - name: loki
          sources: "{{ (groups.get('loki', []) | difference(inventory_hostname)) | map('extract', hostvars, 'ansible_host') | list }}"
      firewall_rules:
        - port: "{{ __loki_grpc_port }}"
          zone: loki

        - port: "{{ __loki_http_port }}"
          zone: "{{ loki_allow_zone }}"
          sources: "{{ loki_allow_ips }}"
    when: loki_config_firewall | bool
    tags: ["firewall"]
