---

- name: rebuild all mkinitcpio presets
  command: /usr/bin/mkinitcpio -P

- name: sign all files
  listen: rebuild all mkinitcpio presets
  command: "/usr/bin/sbctl sign -s {{ item }}"
  register: __sbctl_sign
  changed_when: "'already been signed' not in __sbctl_sign.stdout"
  loop: "{{ __mkinitcpio_sign_files }}"
  when:
    - __mkinitcpio_sign_files is defined
    - __mkinitcpio_sign_files | length > 0
