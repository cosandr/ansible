---
- name: Desktop playbook
  gather_facts: true
  diff: yes
  hosts: desktop
  vars_files: 
    - .secrets/vars.yml
    - role_vars/node_exporter.yml
  vars:
    node_exporter_skip_install: false
    node_exporter_version: "latest"
    node_exporter_port: "{{ ports.node_exporter }}"
    nvidiaexporter_port: "{{ ports.nvidia_exporter }}"
  tasks:
    - import_role: { name: common }
      tags: ["all", "common"]

    - name: Merge ports
      set_fact:
        ports: "{{ ports | combine(_ports, recursive=true) }}"
      tags: ["always"]

    - import_role: { name: node_exporter }
      tags: ["prometheus-stack", "node_exporter"]

    - import_role: { name: nvidia_exporter }
      tags: ["prometheus-stack", "nvidia_exporter"]
