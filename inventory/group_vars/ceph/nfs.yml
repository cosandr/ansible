---

ceph_nfs_clusters:
  - name: "cephfs"
    port: 2050
    count: 2
    config: |
      NFSV4 {
          Allow_Numeric_Owners = true;
          Only_Numeric_Owners = true;
      }

ceph_nfs_exports:
  - path: "/"
    cluster_id: "{{ ceph_nfs_clusters[0].name }}"
    access_type: "NONE"
    pseudo: "/root"
    clients:
      - access_type: "RW"
        addresses:
          - "{{ hostvars['desktop'].ansible_host }}"
      - access_type: "RW"
        addresses:
          - "{{ all_net.san.cidr }}"

  - path: "/kube"
    cluster_id: "{{ ceph_nfs_clusters[0].name }}"
    pseudo: "/kube"
    access_type: "NONE"
    clients:
      - access_type: "RW"
        addresses: "{{ groups['k8s_cluster'] | map('extract', hostvars, 'ansible_host') }}"

__ceph_nfs_client_addresses: "{{ ceph_nfs_exports | map(attribute='clients') | flatten | map(attribute='addresses') | flatten | unique }}"
