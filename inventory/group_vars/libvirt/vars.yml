---

fstrim_timer_enabled: true
libvirt_vm_engine: "kvm"

vm_disk_format: "raw"
vm_host: "theia"
vm_cpus: 4
vm_mem: 4096
vm_template: "rocky9_packer.{{ vm_disk_format }}"
vm_os_id: "http://rockylinux.org/rocky/9"
vm_disk_pool: "cephfs"
vm_extra_disks: []
vm_started: true
vm_cpu_mode: "{{ 'custom' if vm_cpu_model_name else 'host-passthrough' }}"
vm_cpu_model_name: ""
vm_seclabel: "system_u:system_r:svirt_t:s0:c{{ home_net.vm.vlan }},c{{ __host_num }}"

vm_data_disks: []
# vm_data_disks: ["200G", "150G"]

vm_root_size: "20G"
vm_root_disk:
  name: '{{ inventory_hostname }}-root01.{{ vm_disk_format }}'
  format: "{{ vm_disk_format }}"
  device: 'disk'
  capacity: "{{ vm_root_size }}"
  clone_image: "{{ vm_template }}"
  serial: "root01"
  pool: "{{ vm_disk_pool }}"

vm_default_nic:
  type: bridge
  source:
    dev: 'VM'
  address: "{{ ansible_host }}"
  domain: "vm.{{ domains['hb'] }}"
  gateway: "{{ home_net.vm.cidr | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}"
  dns_servers:
    - "{{ home_net.vm.cidr | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}"
    - 1.1.1.1
    - 8.8.8.8

vm_nics: ["{{ vm_default_nic }}"]

vm_default_definition:
  state: present
  machine: q35
  start: "{{ vm_started }}"
  autostart: "{{ vm_started }}"
  customize: true
  enable_console: true
  enable_vnc: false
  name: "{{ inventory_hostname }}"
  domain: "{{ vm_default_nic.domain | default(false) }}"
  memory_mb: "{{ vm_mem }}"
  vcpus: "{{ vm_cpus }}"
  boot_firmware: efi
  os_id: "{{ vm_os_id }}"
  volumes: "{{ [vm_root_disk] + vm_extra_disks }}"
  interfaces: "{{ vm_nics }}"
  cpu_mode: "{{ vm_cpu_mode }}"
  cpu_model_name: "{{ vm_cpu_model_name }}"
  seclabel_options:
    type: "static"
    relabel: "yes"
    model: "selinux"
  seclabel_label: "{{ vm_seclabel }}"

libvirt_vms: ["{{ vm_default_definition }}"]
