---

node_exporter_config_firewall: false

firewalld_zones:
  - name: public
    interfaces: "{{ host_nic_names }}"

  - name: internal
    sources:
      - "{{ all_net.vm.cidr }}"
      - "{{ all_net.mt.cidr }}"
      - "{{ all_net.mgmt.cidr }}"
      - "{{ hostvars['drepi'].ansible_host }}"
      - "{{ hostvars['ha'].ansible_host }}"

  - name: internal
    sources: "{{ subnets.talos.mon | ansible.utils.ipv4 }}"

firewalld_services:
  - name: cockpit
    zone: public
    state: absent

  - name: cockpit
    zone: internal
    state: absent

  - name: samba-client
    zone: internal
    state: absent

  - name: samba-client
    zone: public
    state: absent

firewall_rules:
  - port: "{{ node_exporter_port }}"
    zone: internal
