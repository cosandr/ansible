---

mt_bgp_peers:
  - as: 65028

mt_dhcp_leases:
  - address: "{{ ansible_host }}"
    mac_address: "{{ vm_default_mac }}"

# Only add VIP once
mt_dns_entries: "{{ (inventory_hostname == groups['talos'][0]) | ternary(__mt_dns_entries_common + __mt_dns_entries_vip, __mt_dns_entries_common) }}"
__mt_dns_entries_common:
  - name: "{{ inventory_hostname }}.{{ domain }}"
    address: "{{ ansible_host }}"

__mt_dns_entries_vip:
  - name: "{{ kube_api_server }}"
    address: "{{ vips.talos.control_plane | ansible.utils.ipv4 | first }}"
  - regexp: ".*\\.{{ kube_ingress_domain | regex_escape() }}$"
    address: "{{ vips.talos.nginx | ansible.utils.ipv4 | first }}"
    ttl: 5m
