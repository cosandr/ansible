---

wireguard_interface: "mt"
wireguard_addresses:
  - "{{ wg_net.mt.cidr | ansible.utils.ipaddr('91') }}"
  - "{{ wg_net.mt.cidr6 | ansible.utils.ipaddr('0x91' | int(base=16)) }}"

wireguard_dns_list:
  - "{{ hostvars['rb5009'].wireguard_ip }}"
  - "{{ hostvars['rb5009'].wireguard_ipv6 }}"
  - "1.1.1.1"
  - "8.8.8.8"

wireguard_mt_allowed_ips:
  - "{{ hostvars['rb5009'].wireguard_ip }}/32"
  - "{{ home_net.vm.cidr }}"
  - "{{ hostvars['dresrv'].ansible_host }}/32"
  - "{{ hostvars['rb5009'].wireguard_ipv6 }}/128"
  - "{{ home_net.vm.cidr6 }}"
  - "{{ hostvars['theia'].ansible_host }}/32"

wireguard_address: "{{ wireguard_addresses | join(', ') }}"
wireguard_ip: "{{ wireguard_addresses[0] | ansible.utils.ipaddr('address') }}"
wireguard_ipv6: "{{ wireguard_addresses[1] | ansible.utils.ipaddr('address') }}"
wireguard_dns: "{{ wireguard_dns_list | join(', ') }}"
wireguard_private_key: "{{ lookup('community.general.passwordstore', 'network/' + inventory_hostname + '_wg_pk') }}"
wireguard_public_key: "{{ vault_wireguard_public_key }}"
wireguard_endpoint: "{{ vault_wireguard_endpoint }}"

wireguard_unmanaged_peers:
  mt:
    endpoint: "{{ hostvars['rb5009'].wireguard_endpoint }}"
    allowed_ips: "{{ wireguard_mt_allowed_ips | join(', ') }}"
    public_key: "{{ hostvars['rb5009'].wireguard_public_key }}"
    preshared_key: "{{ lookup('community.general.passwordstore', 'network/' + inventory_hostname + '_wg_psk_mt') }}"
  romgw:
    endpoint: "{{ hostvars['romsto'].ddns_domain }}:{{ hostvars['romgw01'].wireguard_port }}"
    allowed_ips: "{{ hostvars['romgw01'].wireguard_ip }}/32"
    public_key: "{{ hostvars['romgw01'].wireguard_public_key }}"
    preshared_key: "{{ lookup('community.general.passwordstore', 'network/webgw01_wg_psk_romgw01') }}"
  romsto:
    endpoint: "{{ hostvars['romsto'].ddns_domain }}:{{ hostvars['romsto'].wireguard_port }}"
    allowed_ips: "{{ hostvars['romsto'].wireguard_ip }}/32"
    public_key: "{{ hostvars['romsto'].wireguard_public_key }}"
    preshared_key: "{{ lookup('community.general.passwordstore', 'network/webgw01_wg_psk_romsto') }}"
