---

firewalld_zones:
  - name: public
    interfaces: "{{ host_nic_names }}"

firewalld_services:
  - name: ssh

  - name: smtp
    sources: "{{ __postfix_networks | flatten }}"

  - name: smtps
    sources: "{{ __postfix_networks | flatten }}"

  - name: smtp-submission
    sources: "{{ __postfix_networks | flatten }}"

firewall_rules:
  - port: "{{ (serial_proxies | selectattr('name', 'eq', 'pwr') | first).port }}"
    source: "{{ hostvars['ha'].ansible_host }}"

  - port: "{{ postfix_exporter_port }}"
    sources: "{{ node_exporter_allow_ips }}"

  # NUT
  - port: 3493
    sources: "{{ subnets[host_net].hosts }}"

  # NUT exporter
  - port: 9199
    sources: "{{ node_exporter_allow_ips }}"

mt_firewall_address_lists:
  - address: "{{ ansible_host }}"
    list: smtp
