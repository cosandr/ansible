---

__nfs_all_dataset_hosts:
  - "{{ groups['desktops'] | map('extract', hostvars, 'ansible_host') | list }}"

nfs_shares:
  # Backup shares
  - path: /mnt/tank/backup/pgsql
    options: "rw,no_root_squash"
    sources: "{{ groups['pg'] | map('extract', hostvars, 'ansible_host') | list }}"
  - path: /mnt/tank/backup/gitlab
    options: "rw,no_root_squash"
    sources: "{{ groups['gitlab'] | map('extract', hostvars, 'ansible_host') | list }}"
  - path: /mnt/tank/backup/pgbackrest
    options: "rw,no_root_squash"
    sources: "{{ groups['pgbackrest'] | map('extract', hostvars, 'ansible_host') | list }}"
  # All dataset shares
  - path: /mnt/tank
    options: "rw,no_root_squash"
    sources: "{{ __nfs_all_dataset_hosts | flatten }}"
  - path: /mnt/tank/media/motion
    options: "rw,no_root_squash"
    sources: "{{ [hostvars['drepi'].ansible_host] }}"
  # Docker shares
  - path: /mnt/tank/media
    options: "rw,no_root_squash"
    sources: "{{ groups['docker'] | map('extract', hostvars, 'ansible_host') | list }}"
  - path: /mnt/tank/yes
    options: "ro,no_root_squash"
    sources: "{{ groups['docker'] | map('extract', hostvars, 'ansible_host') | list }}"
  - path: /mnt/tank/downloads
    options: "rw,no_root_squash"
    sources: "{{ groups['docker'] | map('extract', hostvars, 'ansible_host') | list }}"
