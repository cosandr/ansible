---

chezmoi_overrides:
  i3: |
    # Restore based on connected displays
    _hour=$(date +%H)
    if [[ $_hour -ge 8 && $_hour -lt 17 ]]; then
      workhours=1
    else
      workhours=0
    fi

    work_mon=0
    home_mon=0
    mapfile -t present_monitors < <(xrandr --listactivemonitors | awk -F ' ' '{if (NR!=1) {print $(NF)}}')
    for m in "${present_monitors[@]}"; do
      if [[ $m =~ ^DP-3-2$ || $m =~ ^HDMI-1$ ]]; then
        work_mon=$(( work_mon + 1 ))
      fi
      if [[ $m =~ ^DP-3$ || $m =~ ^HDMI-1$ ]]; then
        home_mon=$(( home_mon + 1 ))
      fi
    done

    if [[ $workhours -eq 1 ]]; then
      WS["1"]="work"
      if [[ $home_mon -eq 2 ]]; then
        WS["2"]="work-home"
      elif [[ $work_mon -eq 2 ]]; then
        WS["2"]="work"
        WS["3"]="work"
      fi
    else
      WS["1"]="laptop"
    fi
  polybar: |
    MONITOR_MAP["eDP-1"]="laptop"
    MONITOR_MAP["HDMI-1"]="laptop-ext"
    MONITOR_MAP["DP-3-2"]="laptop-ext-secondary"
    DPI_MAP["eDP-1"]="120"
  sway: |
    export MOZ_ENABLE_WAYLAND=1
    export MOZ_USE_XINPUT2=1
  swayidle: |
    SCREEN_ON=1
  gui: |
    QT_AUTO_SCREEN_SCALE_FACTOR="1"
    QT_QPA_PLATFORMTHEME="qt5ct"
  xinitrc: |
    MOZ_X11_EGL="1"
    xinput set-prop 'ELAN067C:00 04F3:31F9 Touchpad' 'libinput Natural Scrolling Enabled' 1
    xinput set-prop 'ELAN067C:00 04F3:31F9 Touchpad' 'libinput Tapping Enabled' 1
    xinput set-prop 'ELAN067C:00 04F3:31F9 Touchpad' 'libinput Accel Speed' 0.4
    xinput set-prop 'TPPS/2 Elan TrackPoint' 'libinput Accel Speed' -0.5
  lock: |
    idle_hook="xidlehook_lock_screen_on"
    LOCKER="i3lock"
    OPTS="-i $HOME/.wallpaper -t --clock"
  xorg: |
    DPI=120
  xorg_2: |
    DPI=120
  xorg_3: |
    DPI=120
    mon=$(xrandr --query | grep -oP '\S+\s+connected' | cut -d' ' -f1)
    if [[ $mon =~ DP-3$ && $mon =~ HDMI-1 ]]; then
      MONITOR_MAP["DP-3"]="--primary --mode 3840x2160 --rate 120"
      MONITOR_MAP["HDMI-1"]="--above DP-3 --mode 3840x2160"
      MONITOR_MAP["eDP-1"]="--left-of DP-3 --mode 3840x2160"
    elif [[ $mon =~ DP-3-2$ && $mon =~ HDMI-1 ]]; then
      MONITOR_MAP["HDMI-1"]="--primary --mode 3840x2160"
      MONITOR_MAP["DP-3-2"]="--left-of HDMI-1 --mode 3840x2160"
      MONITOR_MAP["eDP-1"]="--right-of HDMI-1 --mode 3840x2160"
    fi
