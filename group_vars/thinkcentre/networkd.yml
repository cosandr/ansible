---

__host_num: "{{ ansible_host.split('.')[-1] }}"

networkd_netdevs:
  - eno1.2: |
      [NetDev]
      Name=eno1.2
      Kind=vlan
      MTUBytes=9000

      [VLAN]
      Id=2

  - eno1.100: |
      [NetDev]
      Name=eno1.100
      Kind=vlan
      MTUBytes=1500

      [VLAN]
      Id=100

networkd_config:
  - eno1: |
      [Match]
      Name=eno1

      [Link]
      MTUBytes=9000

      [Network]
      VLAN=eno1.2
      VLAN=eno1.100
      LinkLocalAddressing=no
      IPv6AcceptRA=no

  - eno1.2: |
      [Match]
      Name=eno1.2

      [Network]
      Address={{ all_net.san.cidr | ansible.utils.ipaddr(__host_num) }}

      [Route]
      Scope=link

  - eno1.100: |
      [Match]
      Name=eno1.100

      [Network]
      Address={{ all_net.mgmt.cidr | ansible.utils.ipaddr(__host_num) }}
      DNS={{ all_net.mgmt.cidr | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}
      DNS=1.1.1.1
      DNS=8.8.8.8

      [Route]
      Gateway={{ all_net.mgmt.cidr | ansible.utils.ipaddr('1') | ansible.utils.ipaddr('address') }}
      Metric=512
      Scope=global
