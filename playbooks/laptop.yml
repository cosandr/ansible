#!/usr/bin/env -S ansible-playbook
---
- name: Override ansible_connection if needed
  import_playbook: prep_local.yml
  tags: ["always"]

- name: Laptop playbook
  gather_facts: true
  hosts: laptop
  vars:
    node_exporter_skip_install: false
    node_exporter_no_sysusers: true
    node_exporter_version: "latest"
    node_exporter_port: "{{ ports.node_exporter }}"
    node_exporter_collectors: []
  tasks:
    - import_role: { name: common }
      tags: ["all"]

    - name: Merge ports
      set_fact:
        ports: "{{ ports | combine(_ports, recursive=true) }}"
      tags: ["always"]

    - import_role: { name: node_exporter }
      tags: ["prometheus-stack", "node_exporter"]

    - import_role: { name: laptop }
      tags: ["laptop"]

    - import_role: { name: arch-common }
      tags: ["arch-common"]

    - import_role: { name: sbctl }
      tags: ["sbctl"]

    - import_role: { name: spotify }
      tags: ["spotify"]

    - import_role: { name: discord }
      tags: ["discord"]

    - import_role: { name: sshd }
      tags: ["sshd"]

    - import_role: { name: sudo }
      tags: ["sudo"]

    - import_role: { name: xss-lock }
      tags: ["xss-lock"]

    - import_role: { name: gnome-keyring }
      tags: ["gnome-keyring"]
