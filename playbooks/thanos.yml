---

# Must manually create user, create thanos policy and assign it to user

- hosts: prom, !webgw
  gather_facts: true
  pre_tasks:
    - name: Create Thanos bucket
      delegate_to: localhost
      amazon.aws.s3_bucket:
        access_key: "{{ hostvars['minio01'].s3_admin_access_key }}"
        secret_key: "{{ hostvars['minio01'].s3_admin_secret_key }}"
        s3_url: "{{ s3_url }}"
        name: thanos
      tags: ["bucket"]

  roles:
    - role: thanos
      tags: ["thanos"]
