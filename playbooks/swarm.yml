#!/usr/bin/env -S ansible-playbook
---

- name: Setup Docker Swarm nodes
  hosts: swarm
  pre_tasks:
    - name: Include common tasks
      ansible.builtin.include_tasks:
        file: ../tasks/common_servers.yml
      tags: ["always"]
  roles:
    - role: ceph_client
      tags: ["ceph"]

    - role: geerlingguy.docker
      tags: ["docker"]

  post_tasks:
    - name: Mount CephFS
      ansible.posix.mount:
        src: swarm@.cephfs=/swarm
        path: /mnt/ceph
        fstype: ceph
        opts: "noatime"
        state: mounted
      tags: ["ceph"]
